<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Attendance App Architecture</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      h1 {
        color: #2d3748;
        text-align: center;
        margin-bottom: 10px;
        font-size: 2.5em;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .subtitle {
        text-align: center;
        color: #718096;
        margin-bottom: 40px;
        font-size: 1.1em;
      }

      .legend {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 20px;
        margin: 30px 0;
        padding: 20px;
        background: #f7fafc;
        border-radius: 10px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .legend-color {
        width: 30px;
        height: 20px;
        border-radius: 4px;
        border: 2px solid #2d3748;
      }

      .diagram-section {
        margin: 40px 0;
        padding: 20px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .section-title {
        font-size: 1.5em;
        color: #4a5568;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e2e8f0;
      }

      .mermaid {
        text-align: center;
        margin: 20px 0;
      }

      .description {
        background: #edf2f7;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        color: #4a5568;
        line-height: 1.6;
      }

      .flow-description {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }

      .flow-card {
        background: linear-gradient(135deg, #667eea15, #764ba215);
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #667eea;
      }

      .flow-card h3 {
        color: #667eea;
        margin-top: 0;
      }

      .flow-card ul {
        margin: 10px 0;
        padding-left: 20px;
        color: #4a5568;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üì± Attendance Tracking App Architecture</h1>
      <p class="subtitle">
        Complete System Architecture & Data Flow Visualization
      </p>

      <div class="legend">
        <div class="legend-item">
          <div class="legend-color" style="background: #ffe4b5"></div>
          <span><strong>Entry Points</strong></span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #e6e6fa"></div>
          <span><strong>Navigation/Routes</strong></span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #ffb6c1"></div>
          <span><strong>UI Components</strong></span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #98fb98"></div>
          <span><strong>State Management</strong></span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #87ceeb"></div>
          <span><strong>Services/API</strong></span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #dda0dd"></div>
          <span><strong>Hooks</strong></span>
        </div>
      </div>

      <!-- Main Architecture Overview -->
      <div class="diagram-section">
        <h2 class="section-title">üèóÔ∏è Complete System Architecture</h2>
        <div class="mermaid">
          graph TB
            %% Entry Point
            App["app/_layout.tsx<br/>üöÄ App Entry Point"]:::entry
            
            %% Authentication Layer
            AuthGate["AuthGate<br/>Auth Protection"]:::auth
            AuthLayout["(auth)/_layout.tsx<br/>Auth Stack"]:::nav
            LoginScreen["login.tsx<br/>Login Screen"]:::ui
            SignupScreen["signup.tsx<br/>Signup Screen"]:::ui
            
            %% Main App Navigation
            TabLayout["(tabs)/_layout.tsx<br/>Tab Navigator"]:::nav
            AttendanceTab["index.tsx<br/>Attendance Tab"]:::ui
            ProfileTab["profile.tsx<br/>Profile Tab"]:::ui
            
            %% Core Components
            AttendanceContainer["AttendanceContainer<br/>Main Logic"]:::core
            ProfileContainer["ProfileContainer<br/>Profile Logic"]:::core
            
            %% State Management
            AuthStore["authStore<br/>Auth State"]:::state
            AttendanceStore["attendanceStore<br/>Attendance State"]:::state
            LocationStore["locationStore<br/>Location State"]:::state
            
            %% Services Layer
            AuthService["authService<br/>Login/Signup API"]:::api
            AttendanceService["attendanceService<br/>Attendance API"]:::api
            ProfileService["profileService<br/>Profile API"]:::api
            CalendarService["attendanceCalendarService<br/>Calendar API"]:::api
            
            %% Hooks Layer
            UseCamera["useCamera<br/>Camera Hook"]:::hook
            UseAudio["useAudio<br/>Audio Hook"]:::hook
            UseGeofence["useGeofence<br/>Location Hook"]:::hook
            UseProfile["useProfile<br/>Profile Hook"]:::hook
            
            %% External APIs
            Backend["Backend API<br/>REST Services"]:::external
            AsyncStorage["AsyncStorage<br/>Local Storage"]:::external
            
            %% Flow connections
            App --> AuthGate
            AuthGate -->|Not Logged In| AuthLayout
            AuthGate -->|Logged In| TabLayout
            AuthLayout --> LoginScreen
            AuthLayout --> SignupScreen
            TabLayout --> AttendanceTab
            TabLayout --> ProfileTab
            AttendanceTab --> AttendanceContainer
            ProfileTab --> ProfileContainer
            
            LoginScreen --> AuthStore
            SignupScreen --> AuthStore
            AttendanceContainer --> AttendanceStore
            AttendanceContainer --> LocationStore
            AttendanceContainer --> UseCamera
            AttendanceContainer --> UseAudio
            AttendanceContainer --> UseGeofence
            ProfileContainer --> UseProfile
            ProfileContainer --> AuthStore
            ProfileContainer --> CalendarService
            
            AuthStore --> AuthService
            AttendanceStore --> AttendanceService
            UseProfile --> ProfileService
            
            AuthService --> Backend
            AttendanceService --> Backend
            ProfileService --> Backend
            CalendarService --> Backend
            
            AuthStore --> AsyncStorage
            AttendanceStore --> AsyncStorage
            LocationStore --> AsyncStorage
            
            classDef entry fill:#FFE4B5,stroke:#FF8C00,stroke-width:3px
            classDef auth fill:#FFF0F5,stroke:#FF1493,stroke-width:2px
            classDef nav fill:#E6E6FA,stroke:#9370DB,stroke-width:2px
            classDef ui fill:#FFB6C1,stroke:#FF69B4,stroke-width:2px
            classDef core fill:#F0E68C,stroke:#DAA520,stroke-width:2px
            classDef state fill:#98FB98,stroke:#228B22,stroke-width:2px
            classDef api fill:#87CEEB,stroke:#4682B4,stroke-width:2px
            classDef hook fill:#DDA0DD,stroke:#8B008B,stroke-width:2px
            classDef external fill:#D3D3D3,stroke:#696969,stroke-width:2px
        </div>
      </div>

      <!-- Data Flow Diagram -->
      <div class="diagram-section">
        <h2 class="section-title">üìä Data Flow & State Management</h2>
        <div class="mermaid">
          flowchart LR
            subgraph User["üë§ User Actions"]
              Login[Login/Signup]
              TakePhoto[Take Photo]
              RecordAudio[Record Audio]
              Submit[Submit Attendance]
              ViewProfile[View Profile]
            end
            
            subgraph Stores["üóÑÔ∏è Zustand Stores"]
              AuthS[authStore]
              AttS[attendanceStore]
              LocS[locationStore]
            end
            
            subgraph API["üåê API Layer"]
              AuthAPI[Auth API]
              AttAPI[Attendance API]
              ProfAPI[Profile API]
            end
            
            subgraph Backend["‚òÅÔ∏è Backend"]
              DB[(Database)]
              Files[File Storage]
            end
            
            Login --> AuthS
            TakePhoto --> AttS
            RecordAudio --> AttS
            Submit --> AttS
            ViewProfile --> LocS
            
            AuthS --> AuthAPI
            AttS --> AttAPI
            LocS --> ProfAPI
            
            AuthAPI --> DB
            AttAPI --> DB
            AttAPI --> Files
            ProfAPI --> DB
            
            DB --> AuthAPI
            DB --> AttAPI
            DB --> ProfAPI
            Files --> AttAPI
            
            style User fill:#FFE4E1
            style Stores fill:#E0FFFF
            style API fill:#F0F8FF
            style Backend fill:#F5F5DC
        </div>
      </div>

      <!-- Component Hierarchy -->
      <div class="diagram-section">
        <h2 class="section-title">üé® Component Hierarchy & Rendering</h2>
        <div class="mermaid">
          graph TD
            Root["_layout.tsx<br/>Root Layout"]
            
            subgraph Auth["Authentication Flow"]
              AuthL["(auth)/_layout.tsx"]
              LoginC["login.tsx"]
              SignupC["signup.tsx"]
            end
            
            subgraph Main["Main App"]
              TabL["(tabs)/_layout.tsx"]
              
              subgraph Attendance["Attendance Feature"]
                AttScreen["index.tsx"]
                AttCont["AttendanceContainer"]
                HomeV["HomeView"]
                CameraV["CameraView"]
                AudioR["AudioRecorder"]
                MapC["MapCard"]
                PhotoG["PhotoGrid"]
                ActionB["ActionButtons"]
              end
              
              subgraph Profile["Profile Feature"]
                ProfScreen["profile.tsx"]
                ProfCont["ProfileContainer"]
                ProfHead["ProfileHeader"]
                AttCal["AttendanceCalendar"]
                LocDrop["LocationDropdown"]
                LogoutB["LogoutButton"]
              end
            end
            
            Root --> Auth
            Root --> Main
            
            AuthL --> LoginC
            AuthL --> SignupC
            
            TabL --> AttScreen
            TabL --> ProfScreen
            
            AttScreen --> AttCont
            AttCont --> HomeV
            AttCont --> CameraV
            AttCont --> AudioR
            AttCont --> MapC
            HomeV --> PhotoG
            HomeV --> ActionB
            
            ProfScreen --> ProfHead
            ProfScreen --> ProfCont
            ProfCont --> AttCal
            ProfCont --> LocDrop
            ProfCont --> LogoutB
            
            style Root fill:#FFD700
            style Auth fill:#FFE4E1
            style Main fill:#E0FFFF
            style Attendance fill:#F0FFF0
            style Profile fill:#FFF0F5
        </div>
      </div>

     <!-- API Call Flow -->
<div class="diagram-section">
  <h2 class="section-title">üîÑ API Call Flow & Responsibilities</h2>
  <div class="mermaid">
    sequenceDiagram
      participant User
      participant UI as UI Component
      participant Hook
      participant Store
      participant API as API Service
      participant Backend
      
      Note over User,Backend: Authentication Flow
      User->>UI: Enter credentials
      UI->>Store: Call signIn/signUp
      Store->>API: loginUser/signupUser
      API->>Backend: POST /login or /signup
      Backend-->>API: User data
      API-->>Store: Update state
      Store-->>UI: Navigate to app
      
      Note over User,Backend: Attendance Submission
      User->>UI: Take photo & audio
      UI->>Hook: useCamera/useAudio
      Hook-->>UI: Media captured
      UI->>Store: Store media
      User->>UI: Submit attendance
      UI->>Store: uploadAttendance
      Store->>API: uploadAttendanceData
      API->>Backend: POST /attendance (multipart)
      Backend-->>API: Success response
      API-->>Store: Update records
      Store-->>UI: Show success
      
      Note over User,Backend: Profile & Location
      User->>UI: View profile
      UI->>Hook: useProfile
      Hook->>API: getUserProfileByUsername
      API->>Backend: GET /profile/username/:id
      Backend-->>API: Profile data
      API-->>Hook: Return data
      Hook-->>UI: Display profile
  </div>
</div>

      <!-- Rest of the content remains the same -->
      <div class="flow-description">
        <div class="flow-card">
          <h3>üöÄ App Initialization</h3>
          <ul>
            <li><strong>app/_layout.tsx</strong> - Entry point, sets up AuthGate</li>
            <li><strong>AuthGate</strong> - Checks auth state from AsyncStorage</li>
            <li><strong>authStore</strong> - Initializes user session</li>
            <li><strong>Navigation</strong> - Routes to auth or main app</li>
          </ul>
        </div>

        <div class="flow-card">
          <h3>üîê Authentication</h3>
          <ul>
            <li><strong>login/signup.tsx</strong> - UI for credentials</li>
            <li><strong>authStore</strong> - Manages auth state</li>
            <li><strong>authService</strong> - API calls to backend</li>
            <li><strong>AsyncStorage</strong> - Persists session</li>
          </ul>
        </div>

        <div class="flow-card">
          <h3>üì∏ Attendance Marking</h3>
          <ul>
            <li><strong>AttendanceContainer</strong> - Main orchestrator</li>
            <li><strong>useCamera/useAudio</strong> - Media capture</li>
            <li><strong>useGeofence</strong> - Location verification</li>
            <li><strong>attendanceService</strong> - Uploads to server</li>
          </ul>
        </div>

        <div class="flow-card">
          <h3>üìç Location Management</h3>
          <ul>
            <li><strong>locationStore</strong> - Selected location state</li>
            <li><strong>useGeofence</strong> - GPS tracking</li>
            <li><strong>GeofenceMap</strong> - Visual representation</li>
            <li><strong>GEOFENCE_LOCATIONS</strong> - Predefined zones</li>
          </ul>
        </div>

        <div class="flow-card">
          <h3>üë§ Profile Management</h3>
          <ul>
            <li><strong>ProfileContainer</strong> - Profile logic</li>
            <li><strong>useProfile</strong> - Fetches user data</li>
            <li><strong>AttendanceCalendar</strong> - History view</li>
            <li><strong>profileService</strong> - Updates location</li>
          </ul>
        </div>

        <div class="flow-card">
          <h3>üíæ State Persistence</h3>
          <ul>
            <li><strong>Zustand persist</strong> - State middleware</li>
            <li><strong>AsyncStorage</strong> - Local storage</li>
            <li><strong>Session data</strong> - Auth persistence</li>
            <li><strong>Attendance records</strong> - Offline cache</li>
          </ul>
        </div>
      </div>

      <!-- File Responsibilities Table -->
      <div class="diagram-section">
        <h2 class="section-title">üìÅ Key File Responsibilities</h2>
        <div class="description">
          <table style="width: 100%; border-collapse: collapse">
            <thead>
              <tr style="background: #667eea; color: white">
                <th style="padding: 12px; text-align: left">File/Module</th>
                <th style="padding: 12px; text-align: left">Primary Responsibility</th>
                <th style="padding: 12px; text-align: left">API Calls</th>
                <th style="padding: 12px; text-align: left">State Management</th>
              </tr>
            </thead>
            <tbody>
              <tr style="background: #f7fafc">
                <td style="padding: 10px"><strong>app/_layout.tsx</strong></td>
                <td style="padding: 10px">Root layout, auth protection</td>
                <td style="padding: 10px">‚ùå</td>
                <td style="padding: 10px">Reads auth state</td>
              </tr>
              <tr>
                <td style="padding: 10px"><strong>authStore.ts</strong></td>
                <td style="padding: 10px">Authentication state</td>
                <td style="padding: 10px">‚úÖ Via authService</td>
                <td style="padding: 10px">Session, user data</td>
              </tr>
              <tr style="background: #f7fafc">
                <td style="padding: 10px"><strong>attendanceStore.ts</strong></td>
                <td style="padding: 10px">Attendance state & logic</td>
                <td style="padding: 10px">‚úÖ Fetch today's attendance</td>
                <td style="padding: 10px">Photos, audio, records</td>
              </tr>
              <tr>
                <td style="padding: 10px"><strong>authService.ts</strong></td>
                <td style="padding: 10px">Auth API calls</td>
                <td style="padding: 10px">‚úÖ Login, signup</td>
                <td style="padding: 10px">‚ùå</td>
              </tr>
              <tr style="background: #f7fafc">
                <td style="padding: 10px"><strong>attendanceService.ts</strong></td>
                <td style="padding: 10px">Attendance API calls</td>
                <td style="padding: 10px">‚úÖ Upload, checkout</td>
                <td style="padding: 10px">‚ùå</td>
              </tr>
              <tr>
                <td style="padding: 10px"><strong>profileService.ts</strong></td>
                <td style="padding: 10px">Profile API calls</td>
                <td style="padding: 10px">‚úÖ Get/update profile</td>
                <td style="padding: 10px">‚ùå</td>
              </tr>
              <tr style="background: #f7fafc">
                <td style="padding: 10px"><strong>AttendanceContainer.tsx</strong></td>
                <td style="padding: 10px">Attendance UI orchestration</td>
                <td style="padding: 10px">‚ùå</td>
                <td style="padding: 10px">Uses stores</td>
              </tr>
              <tr>
                <td style="padding: 10px"><strong>useGeofence.ts</strong></td>
                <td style="padding: 10px">Location tracking</td>
                <td style="padding: 10px">‚ùå</td>
                <td style="padding: 10px">Location state</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <script>
      mermaid.initialize({
        startOnLoad: true,
        theme: "default",
        themeVariables: {
          primaryColor: "#667eea",
          primaryTextColor: "#2d3748",
          primaryBorderColor: "#764ba2",
          lineColor: "#5a67d8",
          secondaryColor: "#e2e8f0",
          tertiaryColor: "#f7fafc",
        },
      });
    </script>
  </body>
</html>